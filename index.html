<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feed de Postagens</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Seus estilos continuam os mesmos */
    </style>
</head>

<body>
    <!-- Navbar -->
    <div id="navbar">
        <div class="logo">FreeFlow</div>
        <div class="menu-icons">
            <i class="fas fa-home"></i>
            <i class="fas fa-user-friends"></i>
            <i class="fas fa-bell"></i>
            <i class="fas fa-cog"></i>
        </div>
    </div>

    <!-- Feed -->
    <div id="feed">
        <!-- As postagens serão adicionadas aqui -->
    </div>

    <!-- Modal de Comentários -->
    <!-- Seu código continua o mesmo -->
    
    <!-- Caixa de nova postagem -->
    <div id="post-box">
        <textarea id="post-text" placeholder="Escreva algo..."></textarea>
        <div class="icon-container">
            <label for="post-image"><i class="fas fa-camera"></i></label>
            <input type="file" id="post-image">
        </div>
        <img id="preview-image" alt="Preview">
        <button id="post-button">Postar</button>
    </div>

    <!-- Botão flutuante de nova postagem -->
    <button id="new-post-button"><i class="fas fa-plus"></i></button>

    <!-- Botão "Voltar ao topo" -->
    <button id="back-to-top"><i class="fas fa-arrow-up"></i></button>

    <script type="module">
        // Importações do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-storage.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "freeflow-17f32.firebaseapp.com",
            projectId: "freeflow-17f32",
            storageBucket: "freeflow-17f32.appspot.com",
            messagingSenderId: "408661719473",
            appId: "1:408661719473:web:e8c503b001d5b0ad6c7335",
            measurementId: "G-MWPRTZ7Y8F"
        };

        // Inicialização do Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Função para salvar posts no Firestore
        async function savePost(content, imageFile) {
            try {
                let imageUrl = "";
                
                if (imageFile) {
                    const imageRef = ref(storage, `images/${imageFile.name}`);
                    const snapshot = await uploadBytes(imageRef, imageFile);
                    imageUrl = await getDownloadURL(snapshot.ref);
                }
                
                await addDoc(collection(db, "posts"), {
                    content: content,
                    imageUrl: imageUrl,
                    createdAt: new Date()
                });
                console.log("Post adicionado com sucesso!");
            } catch (error) {
                console.error("Erro ao salvar post: ", error);
            }
        }

        // Função para carregar posts do Firestore
        function loadPosts() {
            const feed = document.getElementById('feed');
            onSnapshot(collection(db, "posts"), (snapshot) => {
                feed.innerHTML = ''; // Limpar o feed antes de carregar os novos posts
                snapshot.forEach(doc => {
                    const post = doc.data();
                    const newPost = document.createElement('div');
                    newPost.classList.add('post');

                    const content = document.createElement('div');
                    content.classList.add('post-content');
                    content.textContent = post.content;
                    newPost.appendChild(content);

                    if (post.imageUrl) {
                        const image = document.createElement('img');
                        image.classList.add('post-image');
                        image.src = post.imageUrl;
                        newPost.appendChild(image);
                    }

                    feed.appendChild(newPost);
                });
            });
        }

        // Carregar posts ao iniciar
        document.addEventListener('DOMContentLoaded', loadPosts);

        // Postar
        const postButton = document.getElementById('post-button');
        postButton.addEventListener('click', () => {
            const postText = document.getElementById('post-text').value;
            const postImage = document.getElementById('post-image').files[0];
            if (postText.trim() || postImage) {
                savePost(postText, postImage);
                document.getElementById('post-text').value = ''; // Limpar o campo de texto
                document.getElementById('preview-image').src = ''; // Limpar a imagem de pré-visualização
            }
        });

        // Pré-visualização da imagem
        const postImageInput = document.getElementById('post-image');
        postImageInput.addEventListener('change', () => {
            const file = postImageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = () => {
                    const previewImage = document.getElementById('preview-image');
                    previewImage.src = reader.result;
                    previewImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('preview-image').style.display = 'none';
            }
        });
    </script>
</body>

</html>
